<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Sandwich news</title>
  <link rel="shortcut icon" href="/static/images/sandwich-black.png">	
  <link rel="stylesheet" href="/static/css/blog.css">
  <link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">  
	<link rel="alternate" type="application/rss+xml" title="My Blog Feed" href="/rss.xml">
  <style type="text/css">

   </style>
</head>
<body class="w-100 sans-serif bg-white">
  <main>
    <div data-name="component" > <!-- style="background-color: #eb6864"> -->
      <nav class="dt w-100 border-box pa2 ph5-ns">
         <a class="dtc v-mid white link dim w-25" href="/" title="Home">
           <img src="/static/images/sandwich-black.png" class="dib w2 h2 br-100" alt="Site Name">
         </a>
         <div class="dtc v-mid w-75 tr">
           <a class="link underline-hover black f5 f4-ns dn dib-l mr3 mr3-ns" href="/tag/technology/" title="Technology">technology</a>
           <a class="link underline-hover black f5 f4-ns dib dn-l mr3 mr3-ns" href="/tag/technology/" title="Technology">tech üíª</a>           

           <a class="link underline-hover black f5 f4-ns dn dib-l mr3 mr3-ns" href="/tag/photography/" title="Photography">photography</a>
           <a class="link underline-hover black f5 f4-ns dib dn-l mr3 mr3-ns" href="/tag/photography/" title="Photography">photo üì∑</a>
           
           <a class="link underline-hover black f5 f4-ns dn dib-l mr3 mr3-ns" href="/tag/sandwich/" title="Sandwiches">sandwiches</a>
           <a class="link underline-hover black f5 f4-ns dib dn-l mr3 mr3-ns" href="/tag/sandwich/" title="Sandwiches">`wich üçû</a>
         </div>
      </nav>
  </div>
  
<article class="">
    <header style="background-color: rgba(0, 3, 0, 0.03)"
    class="aventir ph3 ph4-ns pv1 pv2-ns">
        <h1 class="f3 fw8 f2-m f1-l mb2">
          the story of HOD - ahead of its time, obsolete at launch</h1>
        <time class="f5 f4-l db fw4 mb4">
          October 10, 2011
        </time>
      </header>
  <div class="ph3 center serif pt2 measure-wide lh-copy f4">
    <p>Last week we shut down an early part of the bizo infrastructure : HOD (Hadoop on Demand). I thought it might be fun to look back on this project a bit.</p>
<p>We've been using AWS as long as bizo has been around, since early 2008. Hadoop has always been a big part of that. When we first started, we were mostly using a shared hadoop cluster. This was kind of a pain for job scheduling, but also was mostly wasteful during off-peak hours... Thus, HOD was born.</p>
<p>From its documentation, "The goal of HOD is to provide an on demand, scalable, sandboxed infrastructure to run Hadoop jobs." <a href="http://aws.amazon.com/elasticmapreduce/">Sound familiar</a>? HOD was developed late September and October of 2008, and launched for internal use December 12th, 2008. Amazon announced <a href="http://aws.amazon.com/elasticmapreduce/">EMR</a> April of 2009. It's amazing how similar they ended up being... especially since we had no knowledge of EMR at the time. Even though HOD had a few nice features missing from EMR, the writing was on the wall. For new tasks, we wrote them for EMR. We slowly migrated old reports to EMR when they needed changes, or we had the time.</p>
<h1>Architecture</h1>
<p>HOD borrowed quite liberally from the design of <a href="http://aws.amazon.com/articles/1632">Alexa's GrepTheWeb</a>.</p>
<p><img src="/static/images/posts/2011/10/10/hod_overview.png" /></p>
<p>Users submitted job requests to a controller which managed starting exclusive hadoop clusters (master, slaves, hdfs), retrieving job input from S3 to HDFS, executing the job (hadoop map/reduce), monitoring the job, storing job results, and shutting down the cluster on completion. Job information and status was stored in SimpleDB, S3 was used for job inputs and outputs, and SQS was used to manage the job workflow.</p>
<h1>Job Definition</h1>
<p>Jobs were defined as thrift structures:</p>
<pre><code>struct JobRequest {
   1: JobConf job = {},
   2: i32 requested_nodes = 4, // requested number of hadoop slaves
   3: string node_type = "m1.large", // machine size
   4: i32 requested_priority, // job priority
   5: string hadoop_dist, // hadoop version e.g. "0.18.3"
   6: set depends_on = [], // ids of job dependencies
   7: list on_success = [], // success notification
   8: list on_failure = [], // failure notification
   9: set flags = [] // everyone loves flags
 }

 struct JobConf {
   1: string job_name,
   2: string job_jar,  // s3 jar path
   3: string mapper_class,
   4: string combiner_class,
   5: string reducer_class,
   6: set job_input,  // s3 input paths
   7: string job_output,  // s3 output path (optional)
   8: string input_format_class,
   9: string output_format_class,
   10: string input_key_class,
   11: string input_value_class,
   12: string output_key_class,
   13: string output_value_class,

   // list of files for hadoop distributed cache
   14: set user_data = [],
   15: map other_config = {}, // passed directly JobConf.set(k, v)
}
</code></pre>
<p>You'll notice that dependencies could be specified. HOD could hook up the output of 1 or more jobs into the input of a job and wouldn't run the job until all of its dependencies have successfully completed.</p>
<h1>User Interaction</h1>
<p>We had a user program, similar to emr-client that helped construct and job jobs, e.g.:</p>
<pre><code>JOB="\
 -m com.bizo.blah.SplitUDCMap \
 -r com.bizo.blah.UDCReduce \
 -jar com-bizo-release:blah/blah/blah.jar
 -jobName blah \
 -i com-bizo-data:blah/blah/blah/${MONTH} \
 -outputKeyClass org.apache.hadoop.io.Text \
 -outputValueClass org.apache.hadoop.io.Text \
 -nodes 10 \
 -nodeType c1.medium \
 -dist 0.18.3 \
 -emailSuccess larry@bizo.com \
 -emailFailure larry@bizo.com \
"

$HOD_HOME/bin/hod_submit $JOB $@
</code></pre>
<p>There was also some support for querying jobs:</p>
<p><img src="/static/images/posts/2011/10/10/hod_status.png" /></p>
<p>As well as support for viewing job output, logs, counters, etc.</p>
<h1>Nice features</h1>
<p>We've been very happy users of Amazon's EMR since it launched in 2009. There's nothing better than systems you don't need to support/maintain yourself! And they've been really busy making EMR more easy to use and adding great features. Still, there are a few things I miss from HOD.</p>
<h2>Workflow support</h2>
<p>As mentioned, HOD had support for constructing job workflows. You could wire up dependencies amount multiple jobs. E.g. here's an example workflow</p>
<p><img src="/static/images/posts/2011/10/10/hod_acct_01_28_2009.png" /></p>
<p>It would be nice to see something like this in EMR. For really simple workflows, you can sometime squeeze them into a single EMR job as multiple steps, but that doesn't always make sense and isn't always convenient.</p>
<h2>Notification support</h2>
<p>HOD supported notifications directly. Initially just email notifications, but there was a plugin structure in place with an eye towards supporting HTTP endpoint, and SQS notifications.Yes, this is possible by adding a custom EMR job step at the end that checks the status of itself and sends an email/failure notification... But, c'mon, why not just build in easy SNS support? Please?</p>
<h2>Counter support</h2>
<p>Building on that, HOD had direct support/understanding for hadoop counters. When processing large volumes of data, they become really critical in tracking the health of your reports over time. This is something I really miss. Although, it's less obvious how to fold this in with Hive jobs, which is how most of our reports are written these days.</p>
<h2>Arbitrary Hadoop versions</h2>
<p>HOD operated with straight hadoop, so it was possible to have it install an arbitrary version/package just by pointing it to the right distribution in S3.Since Amazon isn't directly using a distribution from the hadoop/hive teams, you need to wait for them to apply their patches/changes and can only run with versions they directly support. This has mostly been a problem with Hive, which moves pretty quickly.It would be really great if they could get to a point where their changes have been folded back into the main distribution.Of course, this is probably something you can do yourself, again with a custom job step to install your own version of Hive‚Ä¶ Still, they have some nice improvements, and again, it would be nice if it were just a simple option to the job.</p>
<h1>The Past / The Future</h1>
<p>Of course, HOD wasn't without its problems :). It's become a bear to manage, especially since we pretty much stopped development / maintenance (aside from rebooting it) back in 2009. It was definitely with a sigh of relief that I pulled the plug.</p>
<p>Still, HOD was a really fun project! It was an early project for me at Bizo, and it was really amazing how easy it was to write a program that starts up machines! and gets other programs installed and running! Part of me wonders if there isn't a place for an open source EMR-like infrastructure somewhere? Maybe for private clouds? Maybe for people who want/need more control? Or for cheapskates? :)</p>
<p>Or maybe HOD v2 is just some wrappers around EMR that provides some of the things I miss : workflow support, notifications, easier job configuration...Something to think about for that next hack day :).</p>
  </div>
  <div class="ph3 center serif pt2 measure-wide lh-copy f4">
      
         <a class="f4 link dim br1 ba ph3 pv2 mb2 dib black"
         href="/tag/technology/">technology</a>
      
         <a class="f4 link dim br1 ba ph3 pv2 mb2 dib black"
         href="/tag/aws/">aws</a>
      
         <a class="f4 link dim br1 ba ph3 pv2 mb2 dib black"
         href="/tag/programming/">programming</a>
      
    </div>
</article>
<article style="background-color: rgba(0, 3, 0, 0.03)" class="mt4 ph3 ph6-ns pv4 bt b--light-gray bb">
    <h1 class="ttu tracked f6">Related</h1>
    <ul class="list pl0">
      
      <li class="pl0">
        <a href="/posts/2016/03/16/pushing-bytes-is-expensive.html" class="link dim near-black db f4 pv2" title="Pushing bytes is expensive">
          Pushing bytes is expensive
          <span>‚Ä∫</span>
        </a>
      </li>
      
      <li class="pl0">
        <a href="/posts/2016/03/15/aws-podcast.html" class="link dim near-black db f4 pv2" title="AWS Podcast">
          AWS Podcast
          <span>‚Ä∫</span>
        </a>
      </li>
      
      <li class="pl0">
        <a href="/posts/2014/02/26/args4j-helpers.html" class="link dim near-black db f4 pv2" title="args4j-helpers">
          args4j-helpers
          <span>‚Ä∫</span>
        </a>
      </li>
      
      <li class="pl0">
        <a href="/posts/2014/02/14/crucible-survivor-code-review-dashboard.html" class="link dim near-black db f4 pv2" title="Crucible Survivor - a code review dashboard">
          Crucible Survivor - a code review dashboard
          <span>‚Ä∫</span>
        </a>
      </li>
      
      <li class="pl0">
        <a href="/posts/2013/02/15/reader-driven-development.html" class="link dim near-black db f4 pv2" title="Reader Driven Development">
          Reader Driven Development
          <span>‚Ä∫</span>
        </a>
      </li>
      
      <li class="pl0">
        <a href="/posts/2012/06/13/golden-rule-of-programming-style.html" class="link dim near-black db f4 pv2" title="The golden rule of programming style">
          The golden rule of programming style
          <span>‚Ä∫</span>
        </a>
      </li>
      
      <li class="pl0">
        <a href="/posts/2012/03/13/on-code-reviews-and-developer-feedback.html" class="link dim near-black db f4 pv2" title="On Code Reviews and Developer Feedback">
          On Code Reviews and Developer Feedback
          <span>‚Ä∫</span>
        </a>
      </li>
      
    </ul>
</article>
            
  </main>
  
  <footer class="pa3 pa4-l black-70 bt b--black-10">
      <div class="mb4-l cf">
        <article class="fl w-50 dib-ns w-auto-ns mr4-m mr5-l mb4 pr2 pr0-ns">
          <h4 class="f5 f4-l fw6">Sandwich News</h4>
          <img width="130" src="http://sandwichnews.org/static/images/ogrodnek2.png" />
          <span class="pt1 f7 f6-l db black-70">¬© Larry Ogrodnek 2011-2018.</span>
        </article>
        <article class="fl w-50 dib-ns w-auto-ns mr4-m mr5-l mb4 pl2 pl0-ns">
          <h4 class="f5 f4-l fw5">Elsewhere</h4>
          <p>
              <li><a href="http://engineers.coffee/">Engineers &amp; Coffee</a></li>
              <li><a href="http://analogmachines.com/">Analog Machines</a></li>
              <li><a href="https://github.com/ogrodnek">GitHub</a></li>
              <li><a href="https://twitter.com/ogrodnek">Twitter</a></li>
              <li><a href="https://flickr.com/logrodnek">Flickr</a></li>
            </p>
        </article>
        <article class="fl w-50 dib-ns w-auto-ns mr4-m mr5-l mb4 pr2 pr0-ns">
          <h4 class="f5 f4-l fw5">Other stuff</h4>
          <p>
              <li><a href="/about.html">About</a></li>
              <li><a href="/rss.xml">RSS</a></li>
            </p>          
        </article>
      </div>
    </footer>
</body>
</html>